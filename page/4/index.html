<!doctype html><html lang=en dir=auto><head><meta name=generator content="Hugo 0.140.0-DEV"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Mini Fish</title><meta name=description content="A Collection of Straightforward HOW-TO Guides"><meta name=author content="Jack Yu"><link rel=canonical href=https://blog.minifish.org/><link crossorigin=anonymous href=/assets/css/stylesheet.45e028aa8ce0961349adf411b013ee39406be2c0bc80d4ea3fc04555f7f4611a.css integrity="sha256-ReAoqozglhNJrfQRsBPuOUBr4sC8gNTqP8BFVff0YRo=" rel="preload stylesheet" as=style><link rel=icon href=https://blog.minifish.org/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.minifish.org/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.minifish.org/favicon-32x32.png><link rel=apple-touch-icon href=https://blog.minifish.org/apple-touch-icon.png><link rel=mask-icon href=https://blog.minifish.org/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://blog.minifish.org/index.xml><link rel=alternate type=application/json href=https://blog.minifish.org/index.json><link rel=alternate hreflang=en href=https://blog.minifish.org/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-G0H8JF722Y"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-G0H8JF722Y")}</script><meta property="og:url" content="https://blog.minifish.org/"><meta property="og:site_name" content="Mini Fish"><meta property="og:title" content="Mini Fish"><meta property="og:description" content="A Collection of Straightforward HOW-TO Guides"><meta property="og:locale" content="en-US"><meta property="og:type" content="website"><meta property="og:image" content="https://blog.minifish.org/android-chrome-512x512.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.minifish.org/android-chrome-512x512.png"><meta name=twitter:title content="Mini Fish"><meta name=twitter:description content="A Collection of Straightforward HOW-TO Guides"><script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"Mini Fish","url":"https://blog.minifish.org/","description":"A Collection of Straightforward HOW-TO Guides","logo":"https://blog.minifish.org/favicon.ico","sameAs":["https://x.com/jackysp","https://github.com/jackysp","https://www.linkedin.com/in/shuaipeng-yu-81280434/","mailto:i@minifish.org"]}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://blog.minifish.org/ accesskey=h title="Mini Fish (Alt + H)">Mini Fish</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://blog.minifish.org/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://blog.minifish.org/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Using delve to Debug Golang Programs</h2></header><div class=entry-content><p>Background When I first started writing Golang, I was always looking for a convenient debugging tool. Back then, I came across documentation about using gdb to debug and also tried delve, but neither felt easy to use. Later, on someone’s advice, I went back to the good old print statements…
Over the past couple of days, I was debugging go test and found that tests would always hang when run per package. I couldn’t think of a suitable method at first, so I thought of delve again. After giving it a try, I found it has become much more mature than before.
...</p></div><footer class=entry-footer><span title='2019-09-16 13:24:00 +0800 +0800'>September 16, 2019</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;613 words&nbsp;·&nbsp;Jack Yu</footer><a class=entry-link aria-label="post link to Using delve to Debug Golang Programs" href=https://blog.minifish.org/posts/dlv/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>How to Deploy a Shadowsocks Server</h2></header><div class=entry-content><p>There are multiple versions of the Shadowsocks server side implementation. The original version was written in Python, and later, enthusiasts implemented it in various programming languages of their liking.
Among all these implementations, I personally think the most reliable and stable one is the original Python version. The reason is simple - it has the most users. The Golang version is said to have the most features and also performs very well, making it quite powerful. This might be due to Golang’s inherent high performance and ease of implementation. There’s also an implementation using libev, a pure C implementation, which also offers good performance and is very lightweight.
...</p></div><footer class=entry-footer><span title='2018-09-27 15:48:00 +0800 +0800'>September 27, 2018</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;305 words&nbsp;·&nbsp;Jack Yu</footer><a class=entry-link aria-label="post link to How to Deploy a Shadowsocks Server" href=https://blog.minifish.org/posts/shadowsocks/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>How Immediate is Golang's Panic</h2></header><div class=entry-content><p>Let’s first look at the following code snippet:
package main import ( "fmt" "os" "runtime" "time" ) func main() { runtime.GOMAXPROCS(2) a := make(map[int]int) go func() { i := 0 for { a[1] = i i++ time.Sleep(1000) } }() for { if a[1] > 1000000 { fmt.Println(a[1]) os.Exit(1) } } } After compiling and running it (assuming your machine has 2 or more cores), you will get the following error:
fatal error: concurrent map read and map write goroutine 1 [running]: runtime.throw(0x10c3e05, 0x21) /usr/local/Cellar/go/1.10.3/libexec/src/runtime/panic.go:616 +0x81 fp=0xc42004bf00 sp=0xc42004bee0 pc=0x10263f1 runtime.mapaccess1_fast64(0x10a5b60, 0xc42007e180, 0x1, 0xc42008e048) /usr/local/Cellar/go/1.10.3/libexec/src/runtime/hashmap_fast.go:101 +0x197 fp=0xc42004bf28 sp=0xc42004bf00 pc=0x1008d27 main.main() /Users/yusp/test/panic3/main.go:22 +0x7c fp=0xc42004bf88 sp=0xc42004bf28 pc=0x108e28c runtime.main() /usr/local/Cellar/go/1.10.3/libexec/src/runtime/proc.go:198 +0x212 fp=0xc42004bfe0 sp=0xc42004bf88 pc=0x1027c62 runtime.goexit() /usr/local/Cellar/go/1.10.3/libexec/src/runtime/asm_amd64.s:2361 +0x1 fp=0xc42004bfe8 sp=0xc42004bfe0 pc=0x104e501 goroutine 5 [runnable]: time.Sleep(0x3e8) /usr/local/Cellar/go/1.10.3/libexec/src/runtime/time.go:102 +0x166 main.main.func1(0xc42007e180) /Users/yusp/test/panic3/main.go:18 +0x61 created by main.main /Users/yusp/test/panic3/main.go:13 +0x59 It seems straightforward; Golang’s map is not thread-safe, and concurrent read and write cause a panic. However, look at the error information on line /Users/yusp/test/panic3/main.go:18 +0x61, which points to line 18 of main.go where Sleep is called, not the actual point of concurrency issue. In a vast stack trace, it becomes even harder to locate the problem.
...</p></div><footer class=entry-footer><span title='2018-07-26 14:24:00 +0800 +0800'>July 26, 2018</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;238 words&nbsp;·&nbsp;Jack Yu</footer><a class=entry-link aria-label="post link to How Immediate is Golang's Panic" href=https://blog.minifish.org/posts/golang-panic/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>How TiDB Implements the INSERT Statement</h2></header><div class=entry-content><p>In a previous article “TiDB Source Code Reading Series (4) Overview of INSERT Statement”, we introduced the general process of the INSERT statement. Why write a separate article for INSERT? Because in TiDB, simply inserting a piece of data is the simplest and most common case. It becomes more complex when defining various behaviors within the INSERT statement, such as how to handle situations with Unique Key conflicts: Should we return an error? Ignore the current data insertion? Or overwrite existing data? Therefore, this article will continue to delve into the INSERT statement.
...</p></div><footer class=entry-footer><span title='2018-07-11 14:18:00 +0800 +0800'>July 11, 2018</span>&nbsp;·&nbsp;11 min&nbsp;·&nbsp;2221 words&nbsp;·&nbsp;Jack Yu</footer><a class=entry-link aria-label="post link to How TiDB Implements the INSERT Statement" href=https://blog.minifish.org/posts/insert-opt/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>How to Use HAProxy to Test CockroachDB</h2></header><div class=entry-content><p>Installing HAProxy yum install haproxy is effective for CentOS 7. After installation, you can start the service using systemctl start haproxy. But don’t rush yet.
Configuring HAProxy Add the following content to /etc/haproxy/haproxy.cfg.
global # The content of global is generally fixed and quite understandable. log 127.0.0.1 local2 maxconn 4096 user haproxy group haproxy chroot /var/lib/haproxy daemon pidfile /var/run/haproxy.pid stats socket /var/run/haproxy.sock # Create a socket file for haproxy nbproc 40 # Start 40 processes to forward concurrently, higher versions can use nbthread, a threaded approach. defaults # This section is mostly copied, not entirely clear on the options. log global mode http option tcplog option dontlognull retries 3 option redispatch maxconn 1024 timeout connect 5000ms timeout client 50000ms timeout server 50000ms listen cdb_cluster 0.0.0.0:3030 # The actual proxy name and address for receiving services. ## cdb balance leastconn - the cluster listening on port 3030. mode tcp balance leastconn # This method is most suitable for databases; do not change. server cdb1 172.16.30.3:26257 check # Check seems to require a port for feedback status; without it, it might not work, but it doesn't matter. server cdb2 172.16.30.3:26258 check server cdb3 172.16.30.3:26259 check server cdb4 172.16.30.3:26260 check Start and Connect systemctl start haproxy to start the service.
...</p></div><footer class=entry-footer><span title='2018-07-10 15:07:00 +0800 +0800'>July 10, 2018</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;301 words&nbsp;·&nbsp;Jack Yu</footer><a class=entry-link aria-label="post link to How to Use HAProxy to Test CockroachDB" href=https://blog.minifish.org/posts/haproxy/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>How to Test CockroachDB Performance Using Benchmarksql</h2></header><div class=entry-content><p>Why Test TPC-C First of all, TPC-C is the de facto OLTP benchmark standard. It is a set of specifications, and any database can publish its test results under this standard, so there’s no issue of quarreling over the testing tools used.
Secondly, TPC-C is closer to real-world scenarios as it includes a transaction model within it. In the flow of this transaction model, there are both high-frequency simple transaction statements and low-frequency inventory query statements. Therefore, it tests the database more comprehensively and practically.
...</p></div><footer class=entry-footer><span title='2018-07-06 21:21:00 +0800 +0800'>July 6, 2018</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;603 words&nbsp;·&nbsp;Jack Yu</footer><a class=entry-link aria-label="post link to How to Test CockroachDB Performance Using Benchmarksql" href=https://blog.minifish.org/posts/cockroachdb-tpcc/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>How to Test CockroachDB Performance Using Sysbench</h2></header><div class=entry-content><p>Compiling Sysbench with pgsql Support CockroachDB uses the PostgreSQL protocol. If you want to use Sysbench for testing, you need to enable pg protocol support in Sysbench. Sysbench already supports the pg protocol, but it is not enabled by default during compilation. You can configure it with the following command:
./configure --with-pgsql Of course, preliminary work involves downloading the Sysbench source code and installing the necessary PostgreSQL header files required for compilation (you can use yum or sudo to install them).
...</p></div><footer class=entry-footer><span title='2018-06-11 13:50:00 +0800 +0800'>June 11, 2018</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;600 words&nbsp;·&nbsp;Jack Yu</footer><a class=entry-link aria-label="post link to How to Test CockroachDB Performance Using Sysbench" href=https://blog.minifish.org/posts/cockroachdb-sysbench/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>How to View CMU DB Group's OLTP-Bench</h2></header><div class=entry-content><p>Introduction to OLTP-Bench OLTP-Bench is an open-source benchmarking tool platform for OLTP scenarios from CMU’s DB Group. It was designed to provide a simple, easy-to-use, and extensible testing platform.
It connects to databases via the JDBC interface, supporting the following test suites:
TPC-C Wikipedia Synthetic Resource Stresser Twitter Epinions.com TATP AuctionMark SEATS YCSB JPAB (Hibernate) CH-benCHmark Voter (Japanese “American Idol”) SIBench (Snapshot Isolation) SmallBank LinkBench Detailed project information can be found here, and the GitHub page is here.
...</p></div><footer class=entry-footer><span title='2018-02-23 00:00:00 +0000 UTC'>February 23, 2018</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;845 words&nbsp;·&nbsp;Jack Yu</footer><a class=entry-link aria-label="post link to How to View CMU DB Group's OLTP-Bench" href=https://blog.minifish.org/posts/oltp-bench/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>How to Use Monospaced Fonts in VS Code</h2></header><div class=entry-content><p>Background The English font set in Microsoft’s VS Code is monospaced, while the Chinese font is not.
Method Download and install the fonts from here. This font combines Source Han Sans and is said to align punctuation strictly. Use the method described here to set up VS Code. PS: It is indeed aligned, although the English text appears a bit narrow.</p></div><footer class=entry-footer><span title='2017-12-26 22:21:06 +0800 +0800'>December 26, 2017</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;61 words&nbsp;·&nbsp;Jack Yu</footer><a class=entry-link aria-label="post link to How to Use Monospaced Fonts in VS Code" href=https://blog.minifish.org/posts/font/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>How to Understand F1's Schema Change</h2></header><div class=entry-content><p>Background The DDL paper on F1 serves as the foundation for TiDB’s DDL implementation. There are two main papers on F1: one provides an overview of F1’s DDL, and the other specifically details the schema change method for DDL. I personally believe the second is key and more confusing to me. There is an introduction to the second paper here, which can help in understanding.
Understanding Online DDL Concept The DDL discussed here refers to online DDL. The concept of online DDL originates from databases like MySQL, whereas PostgreSQL and similar databases might not support it. This concept is also quite vague; the distinction is whether you need to use exclusive locks during DDL operations to block transactions. Therefore, all databases can perform online DDL; it just depends on whether they’re willing to put in the effort. For traditional businesses where 24/7 availability isn’t a priority, DDL operations can be performed during maintenance times or late at night. Even if a few users are online, at most, they might experience minor delays. However, modern internet businesses are strict about maintenance windows, creating a higher demand for non-blocking DDL, which MySQL, as a quintessential internet database, was first to support. The typical implementation involves creating a copy of the schema table, with operations being sent to both the new and old tables during the transition.
...</p></div><footer class=entry-footer><span title='2017-12-25 22:21:06 +0800 +0800'>December 25, 2017</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;920 words&nbsp;·&nbsp;Jack Yu</footer><a class=entry-link aria-label="post link to How to Understand F1's Schema Change" href=https://blog.minifish.org/posts/f1/></a></article><footer class=page-footer><nav class=pagination><a class=prev href=https://blog.minifish.org/page/3/>«&nbsp;Prev&nbsp;3/5
</a><a class=next href=https://blog.minifish.org/page/5/>Next&nbsp;5/5&nbsp;»</a></nav></footer></main><footer class=footer><span>© Mini Fish 2014-present</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>